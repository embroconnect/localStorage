var User = [];
var currentUser = 1;

hideUser();

function hideUser() {
    document.getElementById("viewUsers").style.display = "none";
}

function viewUser() {
    document.getElementById("inputData").style.display = "none";
    document.getElementById("viewUsers").style.display = "block";
}

function numbersOnly(evt) {
    var myEvt = evt || window.event;
    var key = myEvt.keyCode || myEvt.which;
    key = String.fromCharCode(key);
    var regex = /[0-9]/;

    if (!regex.test(key)) {
        myEvt.returnValue = false;
        if (myEvt.preventDefault) myEvt.preventDefault();
    }
}

function load() {
    document.getElementById("userDetails").innerHTML = "";
    if (localStorage.UserRecords) {
        User = JSON.parse(localStorage.UserRecords);
        for (var i = 0; i < User.length; i++) {
            view(i, User[i].firstname, User[i].lastname, User[i].email, User[i].phone);
        }
    }
    clearFields();
}

function store() {
    var firstName = document.getElementById("firstname").value;
    var lastName = document.getElementById("lastname").value;
    var email = document.getElementById("email").value;
    var phone = document.getElementById("phone").value;

    var UserObj = {
        firstname: firstName,
        lastname: lastName,
        email: email,
        phone: phone
    };

    if (currentUser == 1) {
        User.push(UserObj);
    } else {
        User.splice(currentUser, 1, UserObj);
    }

    localStorage.UserRecords = JSON.stringify(User);

    load();

    clearFields();

}

function view(id, firstName, lastName, email, phone) {
    var view = document.getElementById("userDetails");

    var insertRows = view.insertRow();

    insertRows.insertCell(0).innerHTML = id + 1;
    insertRows.insertCell(1).innerHTML = firstName;
    insertRows.insertCell(2).innerHTML = lastName;
    insertRows.insertCell(3).innerHTML = email;
    insertRows.insertCell(4).innerHTML = phone;
    insertRows.insertCell(5).innerHTML = '<div id="action"><button class="btn btn-size" onclick="edit(' + id + ')">Edit</button> <button class="btn btn-size" onclick="wipe(' + id + ')">Delete</button></div>';
}

function wipe(id) {

    User.splice(id, 1);
    localStorage.UserRecords = JSON.stringify(User);
    load();
}

function clearFields() {
    currentUser = 1;

    document.getElementById("firstname").value = "";
    document.getElementById("lastname").value = "";
    document.getElementById("email").value = "";
    document.getElementById("phone").value = "";
    document.getElementById("submit").innerHTML = "Save";
}

function edit(id) {
    currentUser = id;
    var UserObj = User[id];

    document.getElementById("inputData").style.display = "block";
    document.getElementById("viewUsers").style.display = "none";

    document.getElementById("firstname").value = UserObj.firstname;
    document.getElementById("lastname").value = UserObj.lastname;
    document.getElementById("email").value = UserObj.email;
    document.getElementById("phone").value = UserObj.phone;
    document.getElementById("submit").innerHTML = "Update";
}